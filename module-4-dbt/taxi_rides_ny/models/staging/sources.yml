version: 2

sources:
  - name: raw
    description: Raw taxi trip data from NYC TLC
    database: |
      {%- if target.type == 'bigquery' -%}
        {{ env_var('GCP_PROJECT_ID') }}
      {%- else -%}
        taxi_rides_ny
      {%- endif -%}
    schema: |
      {%- if target.type == 'bigquery' -%}
        zoomcamp
      {%- else -%}
        prod
      {%- endif -%}
    config:
      freshness: 
        warn_after: {count: 6, period: hour}
        error_after: {count: 24, period: hour}
    tables:
      - name: green_tripdata
        description: |
          Trip records from NYC Green Taxis.
          
          IMPORTANT: This raw source contains 12.45% of "Dispatch" records (VendorID is NULL) originating 
          from HVFHV bases. These records lack meter data (Payment Type, Rate Code, Passenger Count) 
          and are EXCLUDED from the staging models to maintain data integrity and schema compliance.

        config:
          loaded_at_field: lpep_pickup_datetime

        columns:
          - name: unique_row_id
            description: "Primary key. A unique hash generated for each record to ensure idempotency and prevent duplicates during ingestion."

          - name: file_name
            description: "Lineage field. The name of the source data file used to trace the record back to its origin."

          - name: vendorid
            description: |
              Taxi technology provider (1 = Creative Mobile Technologies, 2 = VeriFone Inc.)
              
              1. VeriFone Inc. (5 769 980 rows) 73.46% 
              2. Creative Mobile Technologies, LLC (1 106 393 rows) 14.09%
              NULL (978 246 rows) 12.45% - IMPORTANT: EXCLUDED

          - name: lpep_pickup_datetime
            description: |
              Date and time when the meter was engaged.
              
              Note:
              LPEP = Livery Passenger Enhancement Program (green taxis).
              Hardware in Green Taxis is historically more prone to battery-related clock resets 
              compared to Yellow Taxis, resulting in more "legacy" date noise.

              Valid Core Data (7,854,351 rows | ~99.99%):
              2019 (6,043,796 rows) 76.95% - Pre-COVID operational baseline.
              2020 (1,734,039 rows) 22.08% - Captures the "Pandemic Crater": volume plummeted from 447k (Jan) to 35k (April), a 92% drop.
              2021 (76,516 rows) 0.97% - Early recovery phase data (January only).
              
              Outliers (268 rows) < 0.01%:
              - (2008-2018): 265 rows. Hardware artifacts. Dates like 2008/2009 are "Battery Reset Bugs" where the meter clock reverted to firmware defaults.
              - (2035-2062): 3 rows. "Bit Flip" anomalies in terminal memory.
              - Note: Any data before August 2013 is physically impossible (pre-launch of Green Taxi program).

          - name: lpep_dropoff_datetime
            description: |
              Date and time when the meter was disengaged.

              Valid Core Data (7,854,039 rows | ~99.99%):
              - 2019 (6,043,842 rows) 76.95% - Pre-pandemic operational baseline.
              - 2020 (1,733,669 rows) 22.07% - COVID-19 lockdown period: Volume collapsed from 447k (Jan) to 35k (April), a 92% drop.
              - 2021 (76,528 rows) 0.97% - Early recovery phase (January-February).

              Trip Duration Audit (Logical Integrity):
              - Standard (96.22%): 7,557,612 rows. Trips between 1 and 60 minutes (Avg 14.82 min).
              - Short/Zero (1.87%): 147,161 rows. Duration < 1 min. Likely aborted trips or terminal technical tests.
              - Long (1.90%): 149,446 rows. Duration between 1 and 24 hours (Avg 354 min). Common for long-distance dispatch or meters left running by drivers.
              - Extreme (65 rows): Duration > 24 hours (Avg ~60 hours). Indicates "hung" hardware or software freezes.
              - Negative (335 rows): Dropoff occurs before Pickup. Critical terminal data processing error.

              Yearly Outliers (269 rows) < 0.01%:
              - (2008-2018): 266 rows. Technical noise. 2008-2009 dates result from the "Battery Reset Bug," where the meter clock reverts to factory defaults.
              - (2035-2062): 3 rows. "Bit Flip" anomalies in terminal memory controllers.

          - name: passenger_count
            description: |
              Number of passengers in the vehicle.
              
              1 (5 929 172 rows) 75.49%
              NULL. Missing data (978 246 rows) 12.45% - IMPORTANT: EXCLUDED
              2 (499 442 rows) 6.36%
              3 (93 071 rows) 1.18%
              4 (34 491 rows) 0.44%
              5 (195 558 rows) 2.49%
              6 (109 245 rows) 1.39% - Legal Max for Minivans
              0 (15 034 rows) 0.19% - Likely driver error or cargo delivery. Left as is to preserve data integrity.
              > 6 (360 rows) < 0.01% - Impossible capacity for standard taxi vehicles. Likely technical glitch or fat-finger error.

          - name: trip_distance
            description: |
              Trip distance in miles.
              
              < 0 (19 487 rows) 0.25% - Technical error. High avg fare ($33) suggests reversal or adjustment records.
              0 (203 448 rows) 2.59% - Negotiated fares (Rate 5) or waiting time. High avg fare ($19) confirms active payment.
              0.01-1 (1 571 801 rows) 20.01% - Short local trips.
              1-10 (5 498 232 rows) 70.00% - Standard trip distance.
              10-50 (560 884 rows) 7.14% - Long trips (inter-borough or airport runs).
              > 50 (767 rows) 0.01% - Outliers. Low avg fare for >100 miles confirms GPS teleportation or hardware glitch.

          - name: PULocationID
            description: |
              TLC Taxi Zone in which the taximeter was engaged.
              
              Top Green Taxi Zones (Strong Northern Manhattan/Queens bias):
              - Zone 74 East Harlem North (616,836 rows) 7.85%
              - Zone 75 East Harlem South (505,462 rows) 6.44%
              - Zone 41 Central Harlem (441,579 rows) 5.62%
              - Zone 82 Elmhurst (319,555 rows) 4.07%
              
              Special/Error Codes:
              - 264 Unknown / 265 N/A (20,138 rows combined) 0.26% - Negligible impact on geospatial analysis.
              - 0 (Zero) - 0 rows. Clean data.

          - name: DOLocationID
            description: |
              TLC Taxi Zone in which the taximeter was disengaged.
              
              Top Drop-off Zones (Mirroring Pickup Zones - Intra-borough travel pattern):
              - Zone 74 East Harlem North (301,052 rows) 3.83%
              - Zone 42 Central Harlem North (281,091 rows) 3.58%
              - Zone 41 Central Harlem (246,082 rows) 3.13%
              - Zone 75 East Harlem South (223,323 rows) 2.84%
              
              Special/Error Codes:
              - 264 Unknown (33,190 rows) 0.42% - Higher than Pickup, likely due to GPS signal loss at destination.
              - 265 N/A (20,324 rows) 0.26%.
              - Total "Invalid" destination impact: < 0.7%.

          - name: ratecodeid
            description: |
              Rate code (1=Standard, 2=JFK, 3=Newark, 4=Nassau/Westchester, 5=Negotiated, 6=Group).
              
              1. Standard rate (6 564 731 rows) 83.58% -  Basically the most clean data)
              Unknown / NULL (978 246 rows) 12.45% - IMPORTANT: EXCLUDED
              5. Negotiated fare (289 701 rows) 3.69% - (Common in Green Taxis)
              2. JFK (13 446 rows) 0.17%
              4. Nassau or Westchester (5 153 rows) 0.07%
              3. Newark (3 212 rows) 0.04%
              6. Group ride (70 rows)  < 0.01%
              99. ??? (Garbage/Test) (60 rows) < 0.01% - Rare (<0.01%) but contains critical outliers like $1M fares

          - name: store_and_fwd_flag
            description: |
              Trip record held in vehicle memory (Y/N).
              
              N (6 856 949 rows) 87.3% - Real-time data transfer via 4G/LTE (Standard behavior)
              NULL (978 246 rows) 12.45% - IMPORTANT: EXCLUDED
              Y (19 424 rows) 0.25% - Store and forward (Trip data stored in memory due to bad connection)

          - name: payment_type
            description: |
              A numeric code signifying how the passenger paid for the trip. 
              
              Note: Unlike the standard DE Zoomcamp approach, this column is strictly typed and documented 
              to enable accurate financial auditing and shadow-trip identification.
              
              Strategic Value:
              - Financial Audit: tip_amount is only reliable for Credit Card (payment_type = 1).
              - Data Cleaning: Identification of 12.45% "shadow" Dispatch trips (payment_type IS NULL).
              - Business Logic: Required for margin analysis (Acquiring fees vs. Cash).

              Distribution:
              1 = Credit Card (3,896,388 rows) 49.61% - The only type with recorded tips (Avg Tip $1.92).
              2 = Cash (2,927,573 rows) 37.27% - Tips are NOT recorded in the system, driving down aggregate stats.
              NULL (978,246 rows) 12.45% - Dispatch/App-based trips. Payment handled via app. IMPORTANT: EXCLUDED.
              3 = No Charge (37,355 rows) 0.48% - Free rides or company/mechanic use.
              4 = Dispute (14,805 rows) 0.19% - Passenger refused to pay or transaction was voided.
              5 = Unknown (252 rows) <0.01% - Hardware glitches or legacy system errors.

          - name: fare_amount
            description: |
              Time and distance fare.
              
              < 0$ (24 226 rows) 0.31% - Technical errors or reversals. Low avg distance (0.37 miles) confirms adjustment nature.
              0$ (18 247 rows) 0.23% - Glitch or promo. High avg distance (3.3 miles) suggests trips occurred but fare was not captured.
              0.01$ - 2.49 (2 385 rows) 0.03% - Below official TLC minimum of $2.50. 
              2.5$ - 100 (7 805 689 rows) 99.38% - Standard fare range.
              100$ - 500 (3 969 rows) 0.05% - Long-distance or specialized trips.
              > 500$ (103 rows) < 0.01% - Outliers. Low avg distance (9.3 miles) confirms these are hardware glitches or fat-finger errors.

          - name: extra
            description: |
              Miscellaneous extras and surcharges.
              
              0$ (4 156 885 rows) 52.92% - Baseline. No surcharges applied.
              0.5$ (1 677 368 rows) 21.36% - Standard Night Surcharge (20:00-06:00).
              1.0$ (1 290 047 rows) 16.42% - Standard Rush Hour Surcharge (16:00-20:00 weekdays).
              2.75$ (620 208 rows) 7.90% - Congestion Surcharge. Often lumped into "extra" instead of its own column.
              3.25$ / 3.75$ (64 036 rows) ~0.82% - Combined surcharges (Congestion $2.75 + Night $0.50 or Rush Hour $1.00).
              5.5$ / 8.25$ (32 134 rows) ~0.41% - High-value surcharges. Likely multiple congestion fees or specialized zone surcharges.
              < 0$ (10 636 rows) 0.14% - Reversals. Negative avg fare confirms these are adjustment records for standard surcharges.
              Outliers (0.8$, 11.0$, 14.5$, etc.) < 0.01% - Technical noise. Unique values with 1-2 rows, likely hardware glitches.

          - name: mta_tax
            description: |
              MTA (Metropolitan Transportation Authority) tax.
              
              0.5$ (7 101 627 rows) 90.41% - Standard NYC MTA Tax.
              0$ (730 584 rows) 9.30% - Tax not applied. Higher avg fare ($28.49) suggests long-distance trips ending outside the MTA jurisdiction or specialized service rates.
              -0.5$ (22 329 rows) 0.28% - Reversals/Adjustments. Negative avg total confirms these are correction records.
              Outliers (3.55$, 17.33$, 4.41$, etc.) < 0.01% - Hardware glitches or data corruption. Extremely rare unique values (often 1 row) with inconsistent total amounts.

          - name: tip_amount
            description: |
              Tip amount must be for credit card only.
              
              0 (4 882 707 rows) 62.16% - Recorded primarily for Cash payments (Type 2). Does not reflect actual tipping behavior for cash transactions.
              Round Numbers (1.0, 2.0, 5.0) ~5.2% - Direct user input via preset "Quick Tip" buttons on the terminal.
              Non-round values (e.g., 1.46, 1.56) ~28% - Auto-calculated percentages (typically 20%, 25%, or 30%) applied to the fare/total.
              2.75 (286,709 rows) 3.65% - Data quality anomaly. Matches the NYS Congestion Surcharge amount; likely a systemic mapping error in the source system where tax was recorded as a tip.
              0.01 (8,768 rows) 0.11% - Technical noise or micro-tips. Likely rounding artifacts or symbolic payments with negligible impact on totals.
              
              99.99% of non-zero tips are associated with Credit Card payments (Type 1).
              Only 100 rows  recorded tips for Cash (Type 2), confirming that cash gratuities are not captured in this dataset.

          - name: tolls_amount
            description: |
              Total tolls paid. Matches MTA 2019 rate hike structure.
              
              0$ (7,479,266 rows) 95.22% - Standard routes without crossings.
              5.76$ / 6.12$ (315,914 rows) 4.02% - MTA Major Crossings (Verrazzano, RFK). Split confirms dataset spans March 2019 rate hike ($5.76 -> $6.12).
              2.29$ / 2.80$ (27,145 rows) 0.35% - MTA Minor Crossings (Marine Pkwy, Cross Bay).
              11.52$ / 12.24$ (10,721 rows) 0.14% - Valid 2-bridge trips (Double major rate).
              2.16$ / 2.64$ (7,415 rows) 0.09% - Potential Fraud/Error. Matches Motorcycle rates, invalid for Taxi/Limo class.
              10.50$ / 12.50$ (3,583 rows) 0.05% - Port Authority Crossings to NJ (Lincoln/Holland Tunnels).
              18.36$ (698 rows) < 0.01% - 3-bridge trips. Validated by extreme avg distance (109 miles).
              2.75$ (481 rows) < 0.01% - Data Quality Error. Congestion Surcharge misplaced in tolls column.

          - name: improvement_surcharge
            description: |
              Taxi Improvement Fund surcharge (Fixed mandated rate of $0.30).
              
              0.30$ (7,213,621 rows) 91.84% - Standard TIF fee for street-hail trips. Matches official TLC regulations.
              0$ (618,834 rows) 7.88% - Surcharge not applied. High avg total ($30.53) indicates Dispatch/Pre-arranged trips or Negotiated fares where the fee is waived or bundled.
              -0.30$ (22,152 rows) 0.28% - Reversals/Adjustments.
              Outliers (0.43$, 0.46$, etc.) < 0.01% - Technical artifacts. No legal basis for these specific values.

          - name: total_amount
            description: |
              Total amount charged to passengers (Fare + Extras + Taxes + Tips + Tolls).
              
              Ranges & Anomalies:
              - < 0$ (24,193 rows) 0.31% - Financial reversals/adjustments. 
              - 0$ (17,402 rows) 0.22% - "Free Rides". Avg distance 2.96 miles. Likely disputed trips or bad debt cleared as Cash $0.00.
              - < 3.30$ (2,559 rows) 0.03% - Below Legal Minimum ($2.50 Base + $0.80 Taxes). Technical glitches.
              - 3.30$ - 100$ (7.8M rows) 99.34% - Standard operating range.
              - > 500$ (111 rows) < 0.01% - Extreme outliers. Max value $4,012.30 (9-mile trip) indicates hardware error.
              
              Pattern Recognition (The "Zoo" Analysis):
              1. The "Cash Signature" (Totals ending in .30 or .80):
                 - 7.80$ (2.6176%), 8.30$ (2.5595%), 7.30$ (2.5417%), 6.80$ (2.5389%).
                 - Logic: Base Fare ($3.30) + Meter increments ($0.50 * N) = Total ends in .30 or .80.
                 - Insight: Represents the most frequent Cash trips (Type 2) where no tip is recorded.
                 
              2. The "20% Standard" (Totals ending in .X6):
                 - 8.76$ (0.6782%), 9.36$ (0.6689%), 8.16$ (0.6511%).
                 - Logic: "Cash Signature" amount * 1.20 (20% Tip). 
                 - Example: 7.30$ (Standard Cash) + 1.46$ (20% Tip) = 8.76$.
                 - Insight: Confirms that the primary tip preset on NYC terminals is exactly 20%.

          - name: trip_type
            description: |
              A code indicating whether the trip was a street-hail (1) or a dispatch (2).
              
              Strategic Decision: This model prioritizes Street-hail operations for core analytics, as Dispatch data is often incomplete or handled via external apps.

              Distribution & Logic:
              1 = Street-hail (6,592,751 rows) 83.93% - Dominant mode. Avg distance ~3 miles. Standard metered fares (RateCode 1).
              2 = Dispatch (283,258 rows) 3.61% - Pre-arranged trips. Avg distance ~6 miles. High usage of Negotiated Fares (RateCode 5).
              
              NULL Analysis (978,610 rows | 12.46% of total):
              - Systemic Missing Data (978,246 rows | 99.96% of NULLs): 
                App-based/Shadow records (Uber/Lyft) lacking VendorID. 
                Extreme avg distance (32.5 miles). EXCLUDED in staging via VendorID filter.
              - Technical Hardware Glitches (364 rows | 0.04% of NULLs): 
                Isolated cases where VendorID is present but trip_type was not recorded. 
                Avg distance ~2.6 miles. RETAINED and handled via COALESCE(trip_type, 0).

          - name: ehail_fee
            description: |
              Legacy/Placeholder field. 
              
              NULL (99.99%) - Systematically unpopulated in public TLC records.
              1.95$ (3 rows) / 0$ (351 rows) - Negligible volume (<0.01%). 
              Conclusion: Column provides no analytical value and is typically excluded from downstream models.

          - name: congestion_surcharge
            description: |
              Surcharge for trips in the Manhattan Congestion Zone (Fixed rate of $2.75).
              
              Data Quality Audit:
              - Explicitly Recorded (953,403 rows) 13.86%: Standard correct records.
              - Zero ($0.00) (78.11%): Valid trips occurring outside the Manhattan exclusion zone.
              - Technical Debt (7.9% of total): Systemic error where $2.75 was incorrectly mapped to the 'extra' column instead of this dedicated field.
              - Anomalies (<0.1%): Occasional $2.50 or $0.75 values, likely legacy rates or shared-trip artifacts.

              Recovery Logic:
              The staging model restores the surcharge by checking the explicit field first, then falling back to the 'extra' column, and finally verifying the mathematical difference in total_amount.

      - name: yellow_tripdata
        description: Raw yellow taxi trip records
        config:
          loaded_at_field: lpep_pickup_datetime
        columns:
          - name: vendorid
            description: |
              Taxi technology provider (1 = Creative Mobile Technologies, 2 = VeriFone Inc., 4 = App/Other).
              
              2. VeriFone Inc. (72 888 917 rows) 63.65%
              1. Creative Mobile Technologies, LLC (39 947 164 rows) 34.88%
              NULL (1 410 461 rows) 1.23% - Represents data pipeline anomalies or HVFHS bleed-over. IMPORTANT: EXCLUDED.
              4. App/Other (267 080 rows) 0.23% - Valid third-party integration. RETAINED.

          - name: tpep_pickup_datetime
            description: |
              Date and time when the meter was engaged.
              
              Valid Core Data (114,512,463 rows | ~99.99%):
              2019 (84,397,708 rows) 73.70% - Pre-COVID operational baseline. Peak volume.
              2020 (24,648,663 rows) 21.52% - Shows massive volume drop starting mid-March due to lockdowns.
              2021 (5,466,092 rows) 4.77% - Valid data retained from previous pipeline loads.
              
              Outlers (1,159 rows) < 0.01%  - (2001-2018): 1,139 rows, (2026-2090): 20 rows

          - name: tpep_dropoff_datetime
            description: |
              Date and time when the meter was disengaged.
              
              Valid Core Data (113,102,125 rows | ~99.99%):
              2019 (84,149,990 rows) 74.40% - Pre-COVID operational baseline. Peak volume.
              2020 (23,840,151 rows) 21.08% - Shows massive volume drop starting mid-March due to lockdowns.
              2021 (5,111,984 rows) 4.52% - Valid data retained from previous pipeline loads.
              
              Outliers (2,376 rows) < 0.01% - Negative duration where dropoff < pickup (1,189 rows), orphaned/hung meter > 24 hours (155 rows), bad years out of bounds (1,032 rows).

          - name: passenger_count
            description: |
              Number of passengers in the vehicle (Driver input).
              
              1 (80 476 264 rows) 70.28% - Dominant pattern.
              2 (16 825 597 rows) 14.69%
              3 (4 633 342 rows) 4.05%
              5 (4 276 717 rows) 3.73%
              6 (2 601 550 rows) 2.27% - Legal Max for SUV/Minivans.
              4 (2 164 377 rows) 1.89%
              
              Data Integrity & Anomalies:
              0 (2 124 176 rows) 1.86% - Likely driver error or cargo-only delivery. RETAINED.
              NULL (1 410 461 rows) 1.23% - Missing data associated with NULL VendorIDs (App-based/Shadow trips). IMPORTANT: EXCLUDED.
              > 6 (1 138 rows) < 0.01% - Impossible capacity (7, 8, 9 pax). Fat-finger errors or RateCode mismatch.

          - name: trip_distance
            description: |
              Trip distance in miles.
              
              Standard Operational Range (93.04%):
              1.01-10 (76 640 801 rows) 66.93% - Core service volume.
              0.01-1 (29 898 353 rows) 26.11% - "Manhattan Grid" trips. Top specific distances: 0.9, 0.8, and 1.0 miles. Massive volume of short-haul ridership.
              
              High-Value & Long Distance (5.95%):
              10.01-100 (6 814 268 rows) 5.95% - Inter-borough travel and Airport runs (JFK/LGA/EWR). High average total ($60.72).
              
              Data Integrity & Logic Audit:
              0 (1 147 766 rows) 1.00% - Negotiated Fares (Rate 5) or Waiting Time. High avg total ($34.08) confirms active billing despite zero displacement.
              < 0 (11 440 rows) 0.01% - Technical errors or financial reversals.
              > 100 (994 rows) < 0.01% - Extreme outliers (Avg $408) caused by signal bounce in high-rise canyons or hardware glitches.

          - name: pulocationid
            description: |
              TLC Taxi Zone in which the taximeter was engaged.
              
              Geographic Concentration (Manhattan Core):
              - Zone 237 (Upper East Side South): 5,079,750 rows (4.44%) - Avg Total $14.68
              - Zone 236 (Upper East Side North): 4,666,802 rows (4.08%) - Avg Total $14.97
              - Zone 161 (Midtown Center): 4,576,791 rows (4.00%) - Avg Total $17.65
              - Zone 186 (Penn Station/Madison Sq West): 4,065,179 rows (3.55%)
              - Zone 162 (Midtown East): 4,037,128 rows (3.52%)
              
              High-Revenue Hubs (Airports):
              - Zone 132 (JFK Airport): 3,481,524 rows (3.04%) - Avg Total $55.05 (Flat Rate context).
              - Zone 138 (LaGuardia Airport): 2,638,321 rows (2.30%) - Avg Total $42.69.
              - Zone 1 (Newark Airport): 10,955 rows (0.01%) - Peak Avg Total $95.66 due to out-of-state surcharges.
              
              Special Codes & Data Quality:
              - 264 (Unknown): 991,978 rows (0.87%) - GPS blind spots in high-density areas. Avg Total $20.49.
              - 265 (N/A): 142,564 rows (0.12%) - Out-of-jurisdiction pickups. High Avg Total ($53.39) indicates long-haul dispatch.
              
          - name: dolocationid
            description: |
              TLC Taxi Zone in which the taximeter was disengaged.
              
              Data Integrity & Logic Audit:
              - High Dispersion: Unlike pickups, drop-offs are more geographically spread. Top zone (236) accounts for 4.23% vs 4.44% in pickups.
              - Terminal Reliability: Zone 264 (Unknown) is slightly less frequent than in pickups, but Zone 265 (N/A) shows a significant 167% increase in volume, signaling more out-of-zone travel.
              
              The "Zoo" Analysis (Geographic Trends):
              - Manhattan Upper Hubs: Zone 236 (UES North) 4.23% and Zone 237 (UES South) 3.95% remain the primary destinations.
              - Midtown Magnet: Zones 161, 170, and 162 combined account for ~9.7% of all drop-offs.
              - High-Premium/Out-of-Town:
                - Zone 265 (N/A): 289,639 rows (0.25%) - Peak Avg Total $89.31. Represents long-distance one-way trips to suburbs/neighboring states.
                - Zone 1 (Newark Airport): 213,910 rows (0.19%) - Max Avg Total $98.44.
                - Zone 132 (JFK): 946,356 rows (0.83%) - Avg Total $60.95.
              
              Special Codes:
              - 264 (Unknown): 956,661 rows (0.84%) - Avg Total $23.15. GPS failures or missing data during meter disengagement.

          - name: ratecodeid
            description: |
              The final rate code in effect at the end of the trip.
              
              Official Rates (98.22%):
              - 1 (Standard Rate): 109,418,041 rows (95.55%) - Avg Total $17.02.
              - 2 (JFK): 2,726,822 rows (2.38%) - Avg Total $67.91. Reflects flat rate + tolls.
              - 5 (Negotiated): 627,487 rows (0.55%) - Avg Total $64.17.
              - 3 (Newark): 234,127 rows (0.20%) - Avg Total $89.54.
              - 4 (Nassau or Westchester): 90,750 rows (0.08%) - Avg Total $86.37.
              - 6 (Group Ride): 723 rows (<0.01%) - Legacy feature.
              
              Data Integrity & Anomalies:
              - NULL (App-based/Shadow): 1,410,461 rows (1.23%) - Linked to missing VendorIDs. Avg Total $34.00.
              - 99 (Meter Glitch): 5,211 rows (<0.01%) - Technical errors. Peak Avg Total $396.94.
              
              - IMPORTANT: Rate Code 99 should be excluded from financial performance models.

          - name: store_and_fwd_flag
            description: |
              Flag indicates whether the trip record was held in vehicle memory before sending to the vendor.
              
              Valid Hardware Flags (98.77%):
              - N (Not a store and forward trip): 112,092,506 rows (97.89%) - Standard real-time data transmission.
              - Y (Store and forward trip): 1,010,655 rows (0.88%) - Occurs in "dead zones" (tunnels, skyscraper canyons). Data was cached in terminal memory.
              
              Missing Data:
              - NULL: 1,410,461 rows (1.23%) - Correlates with missing VendorIDs and RateCodeIDs. Represents digital dispatch/app trips that bypass terminal memory logic.

          - name: payment_type
            description: |
              A numeric code signifying how the passenger paid for the trip. (1=Credit card, 2=Cash, 3=No charge, 4=Dispute, 5=Unknown, 6=Voided)
              
              Primary Payment Methods (97.97%):
              - 1 (Credit card): 81,918,264 rows (71.54%) - Avg Total $19.85. Higher usage for long-distance trips.
              - 2 (Cash): 30,270,063 rows (26.43%) - Avg Total $15.81. Dominates short-haul trips.
              
              Missing & Special Categories:
              - NULL (App-based/E-Hail): 1,410,461 rows (1.23%) - Payments handled outside TPEP terminals. Highest Avg Total ($34.00).
              - 3 (No charge): 624,141 rows (0.55%) - Promotional or administrative rides.
              - 4 (Dispute): 290,645 rows (0.25%) - Fare disputes, typically on low-value trips ($6.37 avg).
              - 5 (Unknown): 48 rows (0.00%) - Negligible data noise.
              
              - NOTE: Tip_amount is only recorded for payment_type 1 (Credit card).
          - name: fare_amount
            description: |
              The time-and-distance fare calculated by the meter.
              
              Main Stream (98.29%):
              - Standard Range ($2.51 - $52.00): 112,554,128 rows. Core business logic. 
              - Common values: $6.00, $6.50, $5.50 (trips ~1-2 miles).
              - JFK Flat Rate ($52.00): 2,737,768 rows.
              
              Baseline & Minima:
              - Minimum Base ($2.50): 476,924 rows (0.42%) - Initial flag drop, very short distance (0.35 mi avg).
              - Sub-minimum (<$2.50): 17,125 rows - Likely administrative adjustments or errors.
              
              Data Integrity & Anomalies:
              - Negative (Reversals): 288,428 rows (0.25%) - Technical voids to cancel incorrect entries.
              - Zero Fare: 47,817 rows (0.04%) - Systems glitches (Avg distance 4.26 miles but $0 bill).
              - Extreme Outliers (>$500): 416 rows - Technical noise or fat-finger errors.
              
              - IMPORTANT: Negative and Zero fares should be filtered out for revenue analysis.
          - name: extra
            description: |
              Miscellaneous extras and surcharges (Driver-entered or auto-calculated).
              
              Standard Surcharges (98.87%):
              0 (44,451,190 rows) 38.82% - No extra charges.
              0.5 (21,688,760 rows) 18.94% - Overnight surcharge.
              2.5 (18,604,819 rows) 16.25% - Manhattan Congestion surcharge.
              1 (13,429,775 rows) 11.73% - Rush hour surcharge.
              3 & 3.5 (15,149,290 rows) 13.23% - Valid combinations of Night/Rush + Congestion.
              
              Integrity & Glitches:
              Negative Values (~130,000 rows) 0.11% - System reversals (-0.5, -1, -4.5).
              Niche Fees: 0.8 (6,394 rows) - Misclassified Improvement Surcharge.
              Extreme Anomalies: Values like 500,000.8 and 87.56 exist. 
              
              - IMPORTANT: For financial reporting, only values {0, 0.5, 1, 2.5, 3, 3.5} should be treated as legitimate surcharges.

          - name: mta_tax
            description: |
              $0.50 MTA tax that is automatically triggered based on the metered rate in use.
              
              Standard Tax Logic (99.31%):
              - 0.5 (113,438,133 rows) 99.06% - Legally mandated tax for trips within the MTA jurisdiction.
              - -0.5 (281,058 rows) 0.25% - Technical reversals of incorrect entries.
              
              Exemptions & Adjustments:
              - 0 (793,531 rows) 0.69% - Trips ending outside the MTA district (NJ, etc.). High Avg Total ($67.14) supports this.
              
              Data Integrity Issues:
              - Extreme Noise: Includes a $500,000.50 anomaly and various "fat-finger" errors ($20, $30.8, etc.).
              - Fractional cents: Values like 0.32, 1.44 are likely software artifacts from older TPEP terminals.
              
              - IMPORTANT: For accounting, filter where mta_tax NOT IN (0, 0.5).

          - name: tip_amount
            description: |
              This field is automatically populated for credit card tips. Cash tips are not included.
              
              Standard Tipping Behavior (69.25% non-zero):
              - 0 (35,206,253 rows) 30.74% - Includes all cash payments and non-tippers. Avg fare $13.47.
              - 1.0 (6,339,981 rows) 5.54% - Standard "round" tip for short trips.
              - 2.0 (4,164,396 rows) 3.64% - Standard "round" tip.
              - 2.06, 1.96, 2.16 (each ~1.2%) - Algorithmic tips (20/25/30% buttons) based on standard meter fares.
              
              Data Integrity & Anomalies:
              - Negative Tips: System reversals (e.g., -$49.9). Represents transaction voids.
              - Extreme Outliers: Values up to $141,492 exist due to hardware glitches or terminal input errors.
              - High Tip-to-Fare Ratio: Some records show tips exceeding $400 on $45 fares.
              
              - NOTE: Financial analysis of tipping culture must filter for payment_type = 1 (Credit Card) only.

          - name: tolls_amount
            description: |
              Total amount of all tolls paid in trip.
              
              Operational Reality (99.59%):
              - 0 (108,204,258 rows) 94.49% - Intra-borough trips or free bridge crossings. Avg Total $16.60.
              - Standard ($0.01 - $6.50): 5,843,697 rows (5.10%) - Major bridges/tunnels (E-ZPass). Avg Total $56.37 signals airport/inter-borough volume.
              
              High-Value Routes:
              - Tunnels & NJ ($6.51 - $20.00): 424,299 rows (0.37%) - Typical for Newark (EWR) or suburb runs. Avg Total $85.86.
              - Long Haul ($20.01 - $100): 35,249 rows (0.03%) - Multi-toll interstate trips.
              
              Data Integrity:
              - Reversals: 5,881 rows (0.01%) - Negative amounts reflecting transaction voids.
              - Extreme Outliers: 238 rows (<0.01%) with tolls >$100. Clearly erroneous hardware spikes.

          - name: improvement_surcharge
            description: |
              $0.30 improvement surcharge assessed trips at the flag drop. The surcharge began being levied in 2015.
              
              Standard Compliance (99.94%):
              - 0.3 (114,153,998 rows) 99.69% - Fixed legally mandated fee.
              - -0.3 (287,320 rows) 0.25% - Standard reversals of incorrect entries.
              
              Exceptions:
              - 0 (72,274 rows) 0.06% - Likely negotiated fares or out-of-town trips (Avg Total $77.94).
              
              Data Noise:
              - Minor anomalies like $1.00 (future rate) or $0.03 (rounding error) exist but are statistically negligible.

          - name: total_amount
            description: |
              The total amount charged to passengers. Does not include cash tips.
              
              Economic Core (99.50%):
              - Standard Range ($3.30 - $100): 113,938,936 rows. Most frequent totals center around $9-$13.
              - Tip Artifacts: Frequent values like $12.36 and $11.76 indicate automated 20% tip calculations on standard fares.
              
              Audit & Integrity:
              - Negative Totals: 287,931 rows (0.25%) - Technical reversals used to void incorrect transactions.
              - Zero/Sub-minimum: 59,048 rows (0.05%) - Records falling below the legal minimum fare ($3.30).
              - Extreme Outliers: 692 rows exceeding $500, including hardware-driven glitches in the six-figure range.
              
              - IMPORTANT: For revenue modeling, filter total_amount > 0 and exclude extreme outliers (> $500).

          - name: congestion_surcharge
            description: |
              Total amount collected in trip for NYS congestion surcharge ($2.50 for yellow taxis). 
              Mandatory below 96th Street in Manhattan since Feb 2019.
              
              Core Distribution (95.57%):
              - 2.5 (96,369,526 rows) 84.16% - Standard Manhattan core trips. Avg total $18.26.
              - 0 (13,070,992 rows) 11.41% - Outer borough or airport trips bypassing the congestion zone. Higher Avg total ($25.55).
              
              Missing & Integrity Issues:
              - NULL (4,855,981 rows) 4.24% - Mixture of pre-Feb 2019 data and technical lag in terminal updates.
              - -2.5 (214,548 rows) 0.19% - Standard transaction reversals.
              - 0.75 / 2.75: Trace noise (<0.01%) likely misclassified from FHV/Green taxi streams.
              
              - NOTE: Values other than 0 or 2.5 should be treated as technical anomalies or reversals.)